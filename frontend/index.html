<!DOCTYPE html>
<html lang="en">
  <head>
    <title>binauralbeats</title>
    <style>
      div.content {
  	    margin-left: 27%;
	    margin-right: 20%;
	    margin-top: 10%;
  	    width: 50%;
      }
	  
	  div h2 {
	    margin-left: 30%
	  }
	  
	  div.slidecontainer {
	    margin-top: 2%;
	    margin-left: 35%;
	    margin-right: 20%;
	    
	  }
    </style>
	<script>
	  
	  var playing = false;
	  
	  var context;
	  var panLeftNode;
	  var panRightNode;
	  
	  var osc1Frequency = 440;
	  var osc1;
	  
	  var osc2Frequency = 447;
	  var osc2;
	  
	  function start() {
		if (this.playing === false) {
	  	  var context = this.context || new AudioContext();
		  this.context = context;
		  
		  this.panLeftNode = context.createStereoPanner();
		  this.panRightNode = context.createStereoPanner();
		  
		  this.panLeftNode.pan.value = -1;
		  this.panRightNode.pan.value = 1;
		  
		  this.osc1Freq = document.getElementById("freq1").value;
		  this.osc1 = context.createOscillator();
		  this.osc1.frequency.value = osc1Freq;
		  
		  this.osc2Freq = document.getElementById("freq2").value;
		  this.osc2 = context.createOscillator();
		  this.osc2.frequency.value = osc2Freq;
		  
		  this.gain = context.createGain()
		  
          this.osc1.connect(this.panLeftNode);
		  this.osc2.connect(this.panRightNode);
		  this.panLeftNode.connect(this.gain);
		  this.panRightNode.connect(this.gain);
		  this.gain.connect(context.destination);
          this.osc1.start(0);
		  this.osc2.start(0);
		  this.playing = true;
		  
		  var minsToPlay = document.getElementById("timerMins").value;
		  timer(minsToPlay);
		}
      }
	  
	  async function stop() {
		this.gain.gain.exponentialRampToValueAtTime(0.00001, context.currentTime + 2)
		await delay(2000);
		this.osc1.stop();
		this.osc2.stop();
		this.playing = false;
		this.gain.gain.exponentialRampToValueAtTime(1, context.currentTime + 1)
      }
	  
	  function updateText() {
		document.querySelector("div.frequencyText1").innerHTML = this.osc1Freq + " Hz";
		document.querySelector('div.frequencyText2').innerHTML = this.osc2Freq + " Hz";
	  }
	  
	  function updateFrequency(newFreq, oscillator) {
	    if (oscillator === 1) {
		  this.osc1Freq = newFreq
		  if (this.playing === true) this.osc1.frequency.value = newFreq;;
		} else if (oscillator === 2) {
		  this.osc2Freq = newFreq;
		  if (this.playing === true) this.osc2.frequency.value = newFreq;
		}
		updateText()
	  }
	  
	  const delay = ms => new Promise(res => setTimeout(res, ms));
	  
	  function timer(mins) {
	    var countdown = mins * 60 * 1000;
	    var timerId = setInterval(function(){
          countdown -= 1000;
          var min = Math.floor(countdown / (60 * 1000));
          var sec = Math.floor((countdown - (min * 60 * 1000)) / 1000);
          
          if (countdown <= 0) {
             stop();
			 alert("Time Is Up");
             clearInterval(timerId);
          } else {
             document.querySelector("div.timer").innerHTML = min + " : " + sec;
          }
        }, 1000);
	  }
	</script>
  </head>
  
  <body>
    <div class="content">
      <h2>BINAURAL BEATS</h2>
    
      <div class="slidecontainer">
        <input type="range" min="30" max="800" value="440" class="slider" id="freq1" onchange="updateFrequency(this.value, 1)">
		<div class="frequencyText1">440 Hz</div>
      </div>
      <div class="slidecontainer">
        <input type="range" min="30" max="800" value="447" class="slider" id="freq2" onchange="updateFrequency(this.value, 2)">
		<div class="frequencyText2">447 Hz</div>
      </div>
	  <input type="number" id="timerMins" value=30><div>Set Minutes</div>
	  <button onclick="start()">Start</button>
	  <button onclick="stop()">Stop</button>
	<div class="timer"></div>
    </div>
  </body>
</html>
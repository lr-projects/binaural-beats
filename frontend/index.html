<!DOCTYPE html>
<html lang="en">
  <head>
    <title>binauralbeats</title>
    <style>
	
	  body {
	    background-color: #2C3E50;
		font-family: courier;
		color: #FDFEFE;
	  }
	  
      div.content {
  	    margin-left: 25%;
	    margin-right: 20%;
	    margin-top: 10%;
  	    width: 50%;
      }
	  
	  div h2 {
	    margin-left: 15%;
		font-size: 50px;
	  }
	  
	  div.slidecontainer {
	    margin-top: 2%;
	    margin-left: 27%;
	    margin-right: 20%;
	  }
	  
	  div.controlbar {
	    margin-top: 2%;
		margin-left: 22%
	  }
	  
	  div.stopbar {
	    margin-top: 2%;
		margin-left: 44%;
		display: none;
	  }
	  
	  div.timer {
		margin-top: 5%;
		margin-left: 30%;
		font-size: 50px;
	  }
	  
	  tr.spaceUnder>td {
        padding-bottom: 1em;
      }
    </style>
	<script>
	  
	  var playing = false;
	  
	  var context;
	  var panLeftNode;
	  var panRightNode;
	  var gain;
	  
	  var osc1Frequency = 440;
	  var osc1;
	  
	  var osc2Frequency = 447;
	  var osc2;
	  
	  var timerId;
	  
	  var volume = 0.5;
	  
	  function start() {
		if (this.playing === false) {
	  	  var context = this.context || new AudioContext();
		  this.context = context;
		  
		  this.panLeftNode = context.createStereoPanner();
		  this.panRightNode = context.createStereoPanner();
		  
		  this.panLeftNode.pan.value = -1;
		  this.panRightNode.pan.value = 1;
		  
		  this.osc1Freq = document.getElementById("freq1").value;
		  this.osc1 = context.createOscillator();
		  this.osc1.frequency.value = osc1Freq;
		  
		  this.osc2Freq = document.getElementById("freq2").value;
		  this.osc2 = context.createOscillator();
		  this.osc2.frequency.value = osc2Freq;
		  
		  this.gain = context.createGain()
		  this.gain.gain.setValueAtTime(0.001, context.currentTime);
		  
          this.osc1.connect(this.panLeftNode);
		  this.osc2.connect(this.panRightNode);
		  this.panLeftNode.connect(this.gain);
		  this.panRightNode.connect(this.gain);
		  this.gain.connect(context.destination);
          this.osc1.start(0);
		  this.osc2.start(0);
		  this.gain.gain.exponentialRampToValueAtTime(this.volume, context.currentTime + 2);
		  this.playing = true;
		  
		  var minsToPlay = document.getElementById("timerMins").value;
		  timer(minsToPlay);
		  document.getElementById("controlbar").style.display = "none";
		  document.getElementById("stopbar").style.display = "block";
		  document.getElementById("countdownWrapper").style.visibility = "visible";
		}
      }
	  
	  async function stop() {
		document.getElementById("controlbar").style.display = "block";
		document.getElementById("stopbar").style.display = "none";
		document.getElementById("countdownWrapper").style.visibility = "hidden";
		this.gain.gain.exponentialRampToValueAtTime(this.volume / 2, context.currentTime + 1);
		this.gain.gain.exponentialRampToValueAtTime(0.0001, context.currentTime + 2);
		clearInterval(this.timerId);
		await delay(2000);
		this.osc1.stop();
		this.osc2.stop();
		this.playing = false;
      }
	  
	  function updateText(oscNum) {
	    if (oscNum === 1) {
		  document.querySelector("div.frequencyText1").innerHTML = this.osc1Freq + " Hz";
		  return;
		} else {
		  document.querySelector('div.frequencyText2').innerHTML = this.osc2Freq + " Hz";
		  return;
		}
	  }
	  
	  function updateFrequency(newFreq, oscillator) {
	    if (oscillator === 1) {
		  this.osc1Freq = newFreq
		  if (this.playing === true) this.osc1.frequency.value = newFreq;
		  updateText(1);
		  return;
		} else if (oscillator === 2) {
		  this.osc2Freq = newFreq;
		  if (this.playing === true) this.osc2.frequency.value = newFreq;
		  updateText(2);
		  return;
 	    }
	  }
	  
	  function updateVolume(newVolume) {
		var newVolumeScaled = newVolume / 100;
		this.volume = newVolumeScaled;
		if (typeof this.gain !== 'undefined') {
		  this.gain.gain.exponentialRampToValueAtTime(this.volume, context.currentTime + 2);
		}
	  }
	  
	  const delay = ms => new Promise(res => setTimeout(res, ms));
	  
	  function timer(mins) {
	    var countdown = mins * 60 * 1000;
		document.querySelector("div.timer").innerHTML = mins + " : " + "00";
	    this.timerId = setInterval(function(){
          countdown -= 1000;
          var min = Math.floor(countdown / (60 * 1000));
          var sec = Math.floor((countdown - (min * 60 * 1000)) / 1000);
          
          if (countdown <= 0) {
             stop();
			 alert("Time Is Up");
             clearInterval(timerId);
          } else {
             document.querySelector("div.timer").innerHTML = min + " : " + sec;
          }
        }, 1000);
	  }
	</script>
  </head>
  
  <body>
    <div class="content">
      <h2>BINAURAL BEATS</h2>
    
      <div class="slidecontainer">
	    <table>
		  <tr class="spaceUnder">
		    <td><label for="freq1">Freq 1 </label></td>
            <td><input type="range" 
						min="30" 
						max="800" 
						value="440" 
						class="slider" 
						id="freq1" 
						onchange="updateFrequency(this.value, 1)"></td>
		    <td><div class="frequencyText1">440 Hz</div></td>
		  </tr>
		  <tr class="spaceUnder">
            <td><label for="freq2">Freq 2 </label></td>
		    <td><input type="range" 
						min="30" 
						max="800" 
						value="447" 
						class="slider" 
						id="freq2" 
						onchange="updateFrequency(this.value, 2)"></td>
		    <td><div class="frequencyText2">447 Hz</div></td>
		  </tr>
		  <tr class="spaceUnder">
	        <td><label for="volumeSlider">Volume </label></td>
	        <td><input type="range" 
						min="1" 
						max="100" 
						value="50" 
						class="volumeSlider" 
						id="volumeSlider"
						onChange="updateVolume(this.value)"></td>
		  </tr>
		</table>
	  </div>
	  <div class="controlbar" id="controlbar">
	    <span id="timerWrapper"><label for="timerMins">Minutes </label><input type="number" id="timerMins" value=30></span>
	    <button onclick="start()" id="startButton">Start</button>
	  </div>
	  <div class="stopbar" id="stopbar"><button onclick="stop()" id="stopButton">Stop</button></div>
	  <div class="timer" id="countdownWrapper" style="visibility: hidden"></div>
    </div>
  </body>
</html>